<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | {{{ PRODUCT_NAME }}}</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- Firebase 配置 -->
    <script src="StreamingAssets/firebase-config.js"></script>
    
    <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #231F20;
            overflow: hidden;
        }
        
        #unity-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #unity-canvas {
            background: #231F20;
            display: block;
        }
        
        /* 桌面端样式 */
        @media (min-width: 768px) and (orientation: landscape) {
            #unity-container {
                background: #000;
            }
            
            #unity-canvas {
                max-width: 540px;
                max-height: 960px;
                width: auto;
                height: 90vh;
                border: 2px solid #333;
                border-radius: 8px;
            }
        }
        
        /* 移动端样式 */
        @media (max-width: 767px), (orientation: portrait) {
            body {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }
            
            #unity-canvas {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                /* 尺寸由JavaScript动态设置 */
            }
        }
        
        /* 加载界面 */
        #unity-loading-bar {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        #unity-logo {
            width: 154px;
            height: 130px;
            background: url('TemplateData/unity-logo-dark.png') no-repeat center / contain;
        }
        
        #unity-progress-bar-empty {
            width: 141px;
            height: 18px;
            margin-top: 10px;
            background: url('TemplateData/progress-bar-empty-dark.png') no-repeat center / contain;
        }
        
        #unity-progress-bar-full {
            width: 0%;
            height: 18px;
            background: url('TemplateData/progress-bar-full-dark.png') no-repeat center / contain;
        }
    </style>
</head>

<body>
    <div id="unity-container">
        <canvas id="unity-canvas" width={{{ WIDTH }}} height={{{ HEIGHT }}} tabindex="-1"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
    </div>

    <script>
        // 响应式适配逻辑
        function resizeCanvas() {
            const canvas = document.querySelector("#unity-canvas");
            const container = document.querySelector("#unity-container");
            
            if (!canvas) return;
            
            const isMobile = window.innerWidth <= 767 || window.innerHeight > window.innerWidth;
            
            if (isMobile) {
                // 移动端：保持Unity原始比例，但填满屏幕
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const gameAspectRatio = 9 / 16; // Unity中设置的宽高比
                
                let displayWidth, displayHeight;
                
                if (screenWidth / screenHeight > gameAspectRatio) {
                    // 屏幕更宽，以高度为准
                    displayHeight = screenHeight;
                    displayWidth = displayHeight * gameAspectRatio;
                } else {
                    // 屏幕更高，以宽度为准  
                    displayWidth = screenWidth;
                    displayHeight = displayWidth / gameAspectRatio;
                }
                
                canvas.style.width = displayWidth + "px";
                canvas.style.height = displayHeight + "px";
                canvas.style.position = "fixed";
                canvas.style.top = "50%";
                canvas.style.left = "50%";
                canvas.style.transform = "translate(-50%, -50%)";
                
                // 添加移动端viewport
                let viewport = document.querySelector('meta[name="viewport"]');
                if (!viewport) {
                    viewport = document.createElement('meta');
                    viewport.name = 'viewport';
                    viewport.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
                    document.getElementsByTagName('head')[0].appendChild(viewport);
                }
            } else {
                // 桌面端：保持Unity原始比例
                const maxWidth = Math.min(540, window.innerWidth * 0.8);
                const maxHeight = Math.min(960, window.innerHeight * 0.9);
                
                // 保持Unity设置的9:16宽高比
                const gameAspectRatio = 9 / 16;
                let canvasWidth, canvasHeight;
                
                if (maxWidth / maxHeight > gameAspectRatio) {
                    canvasHeight = maxHeight;
                    canvasWidth = canvasHeight * gameAspectRatio;
                } else {
                    canvasWidth = maxWidth;
                    canvasHeight = canvasWidth / gameAspectRatio;
                }
                
                canvas.style.width = canvasWidth + "px";
                canvas.style.height = canvasHeight + "px";
                canvas.style.position = "relative";
                canvas.style.top = "auto";
                canvas.style.left = "auto";
                canvas.style.transform = "none";
            }
        }
        
        // 页面加载完成后执行
        window.addEventListener('load', function() {
            resizeCanvas();
        });
        
        // 窗口大小变化时重新调整
        window.addEventListener('resize', function() {
            setTimeout(resizeCanvas, 100);
        });
        
        // 屏幕方向改变时重新调整
        window.addEventListener('orientationchange', function() {
            setTimeout(resizeCanvas, 500);
        });

        // Unity加载逻辑
        const hideFullScreenButton = "";
        const buildUrl = "Build";
        const loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}";
        const config = {
            arguments: [],
            dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}",
            frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}",
            codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}",
#if MEMORY_FILENAME
            memoryUrl: buildUrl + "/{{{ MEMORY_FILENAME }}}",
#endif
#if SYMBOLS_FILENAME
            symbolsUrl: buildUrl + "/{{{ SYMBOLS_FILENAME }}}",
#endif
            streamingAssetsUrl: "StreamingAssets",
            companyName: "{{{ COMPANY_NAME }}}",
            productName: "{{{ PRODUCT_NAME }}}",
            productVersion: "{{{ PRODUCT_VERSION }}}",
            showBanner: unityShowBanner,
        };

        // 显示加载进度
        const loadingBar = document.querySelector("#unity-loading-bar");
        const progressBarFull = document.querySelector("#unity-progress-bar-full");
        
        if (loadingBar) {
            loadingBar.style.display = "block";
        }

        const script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            createUnityInstance(document.querySelector("#unity-canvas"), config, (progress) => {
                if (progressBarFull) {
                    progressBarFull.style.width = 100 * progress + "%";
                }
            }).then((unityInstance) => {
                if (loadingBar) {
                    loadingBar.style.display = "none";
                }
                resizeCanvas();
            }).catch((message) => {
                alert(message);
            });
        };
        document.body.appendChild(script);
    </script>
</body>
</html>
